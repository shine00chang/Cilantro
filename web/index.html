<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cilantro</title>
    <link rel="stylesheet" href="./web/animations.css">
    <link rel="stylesheet" href="./web/output.css">
    <link rel="stylesheet" href="./web/style.css">
  </head>
  <body style="margin: 40px; height: 100vh">

<div class="flex">
  <div
    class="shadow-pop-tl mx-3 p-4 items-stretch font-semibold italic bg-stone-200"
    style="display: inline; font-size: 3rem">
    Cilantro</div>

  <div class="m-2 mt-auto text-3xl font-light italic">the web demo</div>
</div>

<div class="mt-8 mb-2"></div>

<div class="flex p-3" style="background: #eee; border-radius: 1rem">
  <div class="text-bold my-auto m-4 font-semibold"> Examples </div>

  <div style="width: 2px; background: #444; align-self: stretch;"></div>

  <div class="m-2 flex space-x-4 overflow-x-auto no-scrollbar content-stretch">
    <div class="my-auto italic">fibonacci</div>
    <div class="my-auto italic">functions</div>
    <div class="my-auto italic">arithmetic</div>
    <div class="my-auto italic">conditionals</div>
    <div class="my-auto italic">scoping</div>
    <div class="my-auto italic">strings</div>
    <div class="my-auto italic">syntax error</div>
    <div class="my-auto italic">type error</div>
    <div class="my-auto italic">tokenization error</div>
  </div>
  </div> 
</div>

<hr class="m-4">

<div class="italic">your code here:</div>
<div class="grid grid-cols-2 h-3/5">
  <div class="p-4 basis-1/2">
    <button 
       id="compile-btn"
       class="my-5 p-3 w-full italic font-bold bg-stone-200"
        >Compile & Run</button>

    <textarea id="code-area" rows="4" 
      class="block p-2.5 w-full h-3/4 text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
      style="font-family: courier new"
      >println("Hello World!")</textarea>
  </div>

  <div class="p-4 basis-1/2">

    <div 
      id="wat-div"
      class="p-4 h-60 border-solid rounded-md border-slate-300 border-2 overflow-y-scroll text-xs"
      style="font-family: courier new"> 
      WASM code will go here
    </div>

    <hr class="m-4">

    <div id="console" class="p-4 rounded-md text-slate-50 h-48" style="background: #333; font-family: courier new">
      == console ==
    </div>
  </div>
</div>
    

    <script type='module' src='./web/lib-getter.js'></script>
    <script type='module'>
      import init, { compile } from '../js-pkg/cilantro.js';

      async function run_cilantro(source) {
        console.log('== Initializing.. ==');
        const wasm = await init();

        console.log('== Compiling.. ==');
        const code = compile(source);

        console.log('== Done! ==');

        return code;
      }

      const compbtn = document.querySelector('#compile-btn')
      compbtn.addEventListener(
        "mouseenter",
        (event) => {
          const el = event.target;
          el.style.animation = 'none';
          el.offsetHeight; /* trigger reflow */
          el.style.animation = null; 
          el.style.animation = 'shadow-pop-tl 0.3s cubic-bezier(0.470, 0.000, 0.745, 0.715) normal forwards'
        }
      );

      compbtn.addEventListener(
        "mouseleave",
        (event) => 
          event.target.getAnimations()
            .forEach(anim => anim.reverse())
      );

      compbtn.addEventListener(
        "click",
        async event => {
          const source = document.querySelector('#code-area').value.trim();
          const wasm = await run_cilantro(source);
          document.querySelector('#wat-div').innerText = wasm;

          // TODO:: Run WASM Code
        }
      )
    </script>
  </body>
</html>
